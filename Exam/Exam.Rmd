---
title: "Exam"
output: html_document
date: "2026-01-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
This is code for the exam in BIOS15 2025/2026, by Rebecka Antonsson

## Load libraries
```{r}
# collection if packages for data science, for example includes dplyr and ggplot
library(tidyverse)
# for plotting correlation matrix
library(corrplot)
```

## Load and investigate data
Load the input data
```{r}
penstemon <-  read.table("penstemon-1.txt", header=T)
# make the data into a tibble (other type of data frame)
penstemon <- tibble(penstemon)
```
Investigate the data
```{r}
head(penstemon)
nrow(penstemon)
# Plot histogram of the response variable, to see if its normally distributed
hist(penstemon$fitness)
```
Investigate how the response variable (fitness) varies in the different population and experimental Block groups.
```{r}
# Box plot, one box for each population
ggplot(penstemon, aes(x = fitness, fill = Pop)) +
  geom_boxplot() +
  theme(text = element_text(size=25))
```
```{r}
# Change the Block column into the class factor
# This is needed to make the box plot, but also for the ANOVA later
penstemon <- penstemon |> mutate(Block = factor(Block))
# Box plot, one plot for each experimental block
ggplot(penstemon, aes(x = fitness, fill = Block)) +
  geom_boxplot() +
  theme(text = element_text(size=25))
```
This boxplot of the experimental blocks is quite cramped, but I think it still gives a good overview of the variation even if it is very difficult to see any details.

## ANOVA
One way anova to test if the fitness in the different populations varies more than between the populations.
```{r}
# Change the Pop column into the class factor
penstemon <- penstemon |> mutate(Pop = factor(Pop))

#anova
fit <- aov(fitness ~ Pop, data = penstemon)

# check QQ plot
qqnorm(residuals(fit))
qqline(residuals(fit))

anova_table <- summary(fit)[[1]]
anova_table

# Extract sum of squares for between populations and in total
SS_between <- anova_table["Pop", "Sum Sq"]  # Sum of Squares between populations
SS_total <- sum(anova_table[, "Sum Sq"])    # Total Sum of Squares

# Calculate Eta-squared
eta_squared <- SS_between / SS_total
eta_squared

```
The dots in the qq plots follow the line and therefore I inteprent it as normally distributed.\
The f value is very low (~0.19) meaning that very unlikley that there is any variation between groups. Pr(>F) means the p-value assosiated with the F statistics. The p value is quite high (~0.82), so the f value can not be trusted to be true. Therefore I will look at sum of squared and the eta squared.The sum of squares is marginally higher for the Residuals than for the Pop, this means that the within group variation is much larger than the variation between groups. This is also what the p value tells us, which is lower than 0.05 for Pop, meaning that there is not a significant variation between groups.\
Calculationg the propotion of variance explained by the Pop (effect size):
-> 0.5% of the variantion can be explained by the populations
\
One way anova to test if the fitness in the different experimental blocks varies more than between the blocks.
```{r}
#anova
fit <- aov(fitness ~ Block, data = penstemon)

# check QQ plot
qqnorm(residuals(fit))
qqline(residuals(fit))

anova_table <- summary(fit)[[1]]
anova_table

# Extract sum of squares for between populations and in total
SS_between <- anova_table["Block", "Sum Sq"]  # Sum of Squares between populations
SS_total <- sum(anova_table[, "Sum Sq"])    # Total Sum of Squares

# Calculate Eta-squared
eta_squared <- SS_between / SS_total
eta_squared

```
The dots in the qq plots follow the line and therefore I interpreter it as normally distributed.\
The F value here is ~1.31 which is quite close to 1, meaning that the variance between groups is similar to the variance within groups. However, the p value for the f value is ~0.18 which is quite high p value, meaning that the f value is likley to be by random chance. Therefore I will instead look at the eta-squared that was computed. The eta squared is ~0.46, this means that 46% of the variance in fitness can be explained by the experimental block.

## Correlation matrix
A correlation matrix is made to see which of the features are highly correlated.
Specific questions to ask, does tscent correlate with fitness? Does a strong scent mean a high fitness?
How does flower size correlate with tscent?

```{r}
# make the population into 1,2 and 3, the "cor" function can only analyze numbers
penstemon$Pop <- as.integer(penstemon$Pop)
# Change the block column from class "factor" into class "integer". The cor function can't analyze factors.
penstemon$Block <- as.integer(penstemon$Block)

# creating correlation matrix
# selecting all columns except the Pop column which is with characters.
correlation <- cor(penstemon)
# Correlation matrix visualization
corrplot(correlation, method="circle")
# List of highest correlations
corr_list <- correlation %>%
  as.data.frame() %>%
  mutate(var1 = rownames(.)) %>%
  pivot_longer(-var1, names_to = "var2", values_to = "corr") %>%
  filter(var1 < var2) %>%
  arrange(desc(abs(corr)))

corr_list
```

The correlations of interest was tscent with fitness and tcsent with flower size (flwsize). tscent and fitness have a correlation of ~0.51, tscent and flower size has a correlation of ~0.19. Below I plot these two combinations to visualize the correlation/ lack of correlation.
```{r}
ggplot(penstemon, aes(x = tscent, y = fitness)) +
  geom_point(size = 2) +
  theme(text = element_text(size=25))

```

```{r}
ggplot(penstemon, aes(x = tscent, y = flwsize)) +
  geom_point(size = 2) +
  theme(text = element_text(size=25))

```
